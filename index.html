<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ref Formatter â€” AMA Style</title>
<style>
body { font-family: monospace; background:#0a0a0c; color:#ddd; padding:40px; }
textarea { width:100%; height:200px; background:#111; color:#ddd; padding:10px; }
button { margin-top:10px; padding:8px 16px; cursor:pointer; }
.output { margin-top:30px; white-space:pre-wrap; }
</style>
</head>
<body>

<h2>AMA Reference Formatter</h2>

<textarea id="input" placeholder="Paste references here..."></textarea>
<br>
<button onclick="formatRefs()">Format</button>

<div class="output" id="output"></div>

<script>

// ==============================
// AUTHOR FORMATTER (NEW LOGIC)
// ==============================

function formatAuthors(authorString) {

  authorString = authorString.replace(/\.$/, '').trim();

  // Remove existing "et al" if present
  authorString = authorString.replace(/;?\s*et al\.?/i, '');

  const authors = authorString.split(/,\s*(?=[A-Za-z])/);

  const formatted = authors.map(name => {

    name = name.trim();

    // Handle "Last, First Middle"
    if (name.includes(",")) {
      const parts = name.split(",");
      const last = parts[0].trim();
      const first = parts[1].trim();

      const initials = first
        .split(/\s+/)
        .map(n => n.charAt(0).toUpperCase())
        .join("");

      return last + " " + initials;
    }

    // Handle "Last First Middle"
    const parts = name.split(/\s+/);
    const last = parts[0];
    const initials = parts.slice(1)
      .map(n => n.charAt(0).toUpperCase())
      .join("");

    return last + " " + initials;

  });

  // Apply author count rule
  if (formatted.length >= 6) {
    return formatted.slice(0,3).join(", ") + "; et al.";
  }

  return formatted.join(", ") + ".";
}


// ==============================
// MAIN FORMATTER
// ==============================

function formatReference(ref) {

  ref = ref.trim();
  if (!ref) return "";

  // Extract authors (before first period)
  const firstPeriod = ref.indexOf(".");
  if (firstPeriod === -1) return ref;

  const authorPart = ref.substring(0, firstPeriod);
  const rest = ref.substring(firstPeriod + 1).trim();

  const formattedAuthors = formatAuthors(authorPart);

  return formattedAuthors + " " + rest;
}


// ==============================
// UI FUNCTION
// ==============================

function formatRefs() {

  const input = document.getElementById("input").value;

  const refs = input.split("\n").filter(r => r.trim() !== "");

  const formatted = refs.map(r => formatReference(r));

  document.getElementById("output").textContent = formatted.join("\n\n");
}

</script>

</body>
</html>
